apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
bases:
- ../../base

configMapGenerator:
- name: solmar-config-qa
  files:
  - qa-config.properties

# Genera el Secret leyendo el archivo .env (Kustomize lo codifica por ti)
secretGenerator:
- name: solmar-secrets-qa
  envs:
  - qa-secrets.env

# Aplica los patches de imagen y r√©plicas
patchesStrategicMerge:
- image-tags.yaml
- replicas.yaml

# Aplica el parche de variables de entorno a TODOS los Deployments
patches:
- patch: |-
    - op: add
      path: /spec/template/spec/containers/0/envFrom
      value:
        - configMapRef:
            name: solmar-config-qa
        - secretRef:
            name: solmar-secrets-qa
  target:
    kind: Deployment