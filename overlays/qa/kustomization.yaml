# overlays/qa/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

configMapGenerator:
- files:
  - qa-config.properties
  name: solmar-config-qa

# Genera el Secret a partir de texto plano (SIN comillas extra)
secretGenerator:
- literals:
  - ConnectionStrings__DefaultConnection=Server=192.168.126.129,1434;Database=KINICH_QA;User
    Id=app_solmar;Password=4ppS0lm4r#2025*;TrustServerCertificate=True;
  - Jwt__Key=0{e^8Q=VE>A$A+yMgje%nWX&Idw*e&:wDC8q}u87U:PYlD:Oe]PXMk>b_HFciG/8)(v@L_,<XdS:rW:Im3aDV*
  name: solmar-secrets-qa

# Aplica los patches de imagen y rÃ©plicas
patchesStrategicMerge:
- image-tags.yaml
- replicas.yaml

# Aplica el parche de variables de entorno a TODOS los Deployments
patches:
- patch: |-
    - op: add
      path: /spec/template/spec/containers/0/envFrom
      value:
        - configMapRef:
            name: solmar-config-qa
        - secretRef:
            name: solmar-secrets-qa
  target:
    kind: Deployment
resources:
- ../../base
images:
- name: diurvan/solmar-backend-authservice
  newName: diurvan/solmar-backend-authservice
  newTag: "3660273"
- name: diurvan/solmar-backend-catalogservice
  newName: diurvan/solmar-backend-catalogservice
  newTag: "3660273"
- name: diurvan/solmar-backend-finanzasservice
  newName: diurvan/solmar-backend-finanzasservice
  newTag: "3660273"
- name: diurvan/solmar-backend-notificationsservice
  newName: diurvan/solmar-backend-notificationsservice
  newTag: "3660273"
- name: diurvan/solmar-backend-reservationsservice
  newName: diurvan/solmar-backend-reservationsservice
  newTag: "3660273"
- name: diurvan/solmar-backend-yarpproxy
  newName: diurvan/solmar-backend-yarpproxy
  newTag: "3660273"
